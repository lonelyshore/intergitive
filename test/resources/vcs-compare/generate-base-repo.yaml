perStageReset: false
stages:
  - name: init
    contents:
    - !git
      repoSetupName: repo
      command: init
    - !git
      repoSetupName: repo
      command: addConfig
      arguments:
        - user.name
        - test-repo
    - !git
      repoSetupName: repo
      command: addConfig
      arguments:
        - user.email
        - test-repo@some.mail.server
  - name: base1
    contents:
    - !writeFile
      sourceAssetIds:
        - file/base/first_file:v1
      destinationPaths:
        - repo/first_file
    - !stageAll
      repoSetupName: repo
    - !git
      repoSetupName: repo
      command: commit
      arguments:
        - commit
    - !writeFile
      sourceAssetIds:
        - file/base/second_file:v1
      destinationPaths:
        - repo/second_file
    - !stageAll
      repoSetupName: repo
    - !git
      repoSetupName: repo
      command: commit
      arguments:
        - commit
    - !git
      repoSetupName: repo
      command: branch
      arguments:
        - "second-branch": null
  - name: base2
    contents:
      - !writeFile
        sourceAssetIds:
          - file/base/third_file:v1
        destinationPaths:
          - repo/folder/third
      - !stageAll
        repoSetupName: repo
      - !git
        repoSetupName: repo
        command: commit
        arguments:
          - commit
      - !writeFile
        sourceAssetIds:
          - file/base/forth_file:v1
        destinationPaths:
          - repo/folder/forth
      - !stageAll
        repoSetupName: repo
      - !git
        repoSetupName: repo
        command: commit
        arguments:
          - commit
  - name: base3
    contents:
      - !git
        repoSetupName: repo
        command: branch
        arguments:
          - "conflict-AA": null
      - !git
        repoSetupName: repo
        command: branch
        arguments:
          - "conflict-MR": null
      - !git
        repoSetupName: repo
        command: branch
        arguments:
          - "conflict-MM": null
      - !git
        repoSetupName: repo
        command: branch
        arguments:
          - "conflict-mixed": null
  - name: base4
    contents:
      - !writeFile
        sourceAssetIds:
          - file/base/first_file:v2
        destinationPaths:
          - repo/first_file
      - !stageAll
        repoSetupName: repo
      - !git
        repoSetupName: repo
        command: commit
        arguments:
          - commit
      - !removeFile
        targetPaths:
          - repo/second_file
      - !stageAll
        repoSetupName: repo
      - !git
        repoSetupName: repo
        command: commit
        arguments:
          - "remove second file"
      - !writeFile
        sourceAssetIds:
          - file/base/fifth_file:v1
        destinationPaths:
          - repo/folder/fifth
      - !stageAll
        repoSetupName: repo
      - !git
        repoSetupName: repo
        command: commit
        arguments:
          - "add fifth"
  - name: growSecond
    contents:
      - !cleanCheckout
        repoSetupName: repo
        commitish: "second-branch"
      - !writeFile
        sourceAssetIds:
          - file/base/sixth_file:v1
        destinationPaths:
          - repo/second_folder/sixth_file
      - !stageAll
        repoSetupName: repo
      - !git
        repoSetupName: repo
        command: commit
        arguments:
          - "add sixth"
      - !writeFile
        sourceAssetIds:
          - file/base/seventh_file:v1
        destinationPaths:
          - repo/second_folder/seventh_file
      - !stageAll
        repoSetupName: repo
      - !git
        repoSetupName: repo
        command: commit
        arguments:
          - "add seventh"          
  - name: growSecond2
    contents:
      - !removeFile
        targetPaths:
          - repo/second_folder/sixth_file
      - !stageAll
        repoSetupName: repo
      - !git
        repoSetupName: repo
        command: commit
        arguments:
          - "remove sixth"
  - name: growSecond3
    contents:
      - !moveFile
        sourcePath: repo/second_folder/seventh_file
        targetPath: repo/second_folder/periodic_table
      - !stageAll
        repoSetupName: repo
      - !git
        repoSetupName: repo
        command: commit
        arguments:
          - "rename"
  - name: conflict-AA
    contents:
      - !cleanCheckout
        repoSetupName: repo
        commitish: "conflict-AA"
      - !writeFile
        sourceAssetIds:
          - file/base/fifth_file:v2
        destinationPaths:
          - repo/folder/fifth
      - !stageAll
        repoSetupName: repo
      - !git
        repoSetupName: repo
        command: commit
        arguments:
          - "add fifth"
  - name: conflict-MM
    contents:
      - !cleanCheckout
        repoSetupName: repo
        commitish: "conflict-MM"
      - !writeFile
        sourceAssetIds:
          - file/base/first_file:v3
        destinationPaths:
          - repo/first_file
      - !stageAll
        repoSetupName: repo
      - !git
        repoSetupName: repo
        command: commit
        arguments:
          - "modify first"
  - name: conflict-MR
    contents:
      - !cleanCheckout
        repoSetupName: repo
        commitish: "conflict-MR"
      - !writeFile
        sourceAssetIds:
          - file/base/second_file:v2
        destinationPaths:
          - repo/second_file
      - !stageAll
        repoSetupName: repo
      - !git
        repoSetupName: repo
        command: commit
        arguments:
          - "remove second"
  - name: conflict-mixed
    contents:
      - !cleanCheckout
        repoSetupName: repo
        commitish: "conflict-mixed"  
      - !merge
        repoSetupName: repo
        withBranch: "conflict-AA"
      - !merge
        repoSetupName: repo
        withBranch: "conflict-MM"
      - !merge
        repoSetupName: repo
        withBranch: "conflict-MR"
  - name: reset
    contents:
      - !cleanCheckout
        repoSetupName: repo
        commitish: master

